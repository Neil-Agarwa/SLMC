<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sugar Land Methodist Church | Spiritual Gifts Assessment</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    :root {
        --bg-page: #ffffff;
        --bg-card: #ffffff;
        --bg-pill: #eef6ff;
        --border-card: #dbe5f5;
        --text-main: #1e293b;
        --text-dim: #64748b;
        --accent: #1c4f9e;
        --accent-light: #eef6ff;
        --shadow-card: 0 24px 50px -12px rgba(0,0,0,0.08);
        --radius-lg: 1rem;
        --radius-md: .75rem;
        --radius-sm: .5rem;
    }
    body {
        background: var(--bg-page);
        color: var(--text-main);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 0;
        line-height: 1.45;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .site-header {
        width: 100%;
        background: var(--bg-page);
        border-bottom: 4px solid var(--accent);
        box-shadow: 0 12px 24px -8px rgba(0,0,0,0.07);
        padding: 1rem 1.5rem;
    }
    .header-inner {
        max-width: 1300px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
    }
    .header-left {
        display: flex;
        align-items: center;
        gap: 16px; /* spacing between logo and text */
        min-width: 250px;
    }
    .church-logo {
        height: 60px;
        width: auto;
        object-fit: contain;
    }
    .church-text {
        color: var(--accent);
        font-weight: 600;
        font-size: 1rem;
        line-height: 1.2;
    }
    .church-text span {
        display: block;
        color: var(--text-main);
        font-weight: 500;
        font-size: .8rem;
    }
    .header-right {
        flex: 1;
        min-width: 200px;
        text-align: right;
        color: var(--text-main);
    }
    @media(max-width:900px){
        .header-right { text-align:left; }
    }
    .header-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-main);
        line-height: 1.2;
    }
    .header-subtitle {
        font-size: .8rem;
        color: var(--text-dim);
        line-height: 1.3;
        margin-top: .25rem;
    }
    .layout {
        max-width: 1300px;
        width: 100%;
        display: grid;
        grid-template-columns: minmax(0,1fr) minmax(320px,380px);
        gap: 2rem;
        padding: 2rem 1.5rem 4rem 1.5rem;
        box-sizing: border-box;
    }
    @media(max-width:900px){
        .layout { grid-template-columns: 1fr; }
    }
    .card {
        background: var(--bg-card);
        border: 1px solid var(--border-card);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-card);
        padding: 1.5rem 2rem;
        max-height: 80vh;
        overflow-y: auto;
    }
    .instructions {
        font-size: 0.9rem;
        color: var(--text-dim);
        background: var(--accent-light);
        border: 1px solid var(--border-card);
        border-radius: var(--radius-md);
        padding: 1rem 1rem;
        margin-bottom: 1rem;
    }
    .instructions-title {
        color: var(--accent);
        font-weight: 600;
        margin: 0 0 .5rem 0;
        font-size: .9rem;
    }
    .question {
        border-bottom: 1px solid var(--border-card);
        padding: 0.75rem 0 1rem 0;
        margin-bottom: 0.75rem;
    }
    .q-text {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        color: var(--text-main);
        font-weight: 500;
    }
    .q-scale {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: .5rem;
        font-size: .8rem;
        color: var(--text-dim);
    }
    select {
        background: #fff;
        color: var(--text-main);
        border: 1px solid var(--border-card);
        border-radius: var(--radius-sm);
        padding: .45rem .6rem;
        font-size: 0.9rem;
        min-width: 180px;
    }
    select:focus {
        outline: 2px solid var(--accent);
        outline-offset: 1px;
    }
    button#submitBtn,
    button#exportBtn,
    button#sendBtn {
        appearance: none;
        background: var(--accent);
        border: 0;
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
        padding: .9rem 1rem;
        border-radius: var(--radius-md);
        width: 100%;
        cursor: pointer;
        margin-top: 1rem;
        box-shadow: 0 20px 40px -8px rgba(28,79,158,.4);
    }
    button#submitBtn:hover,
    button#exportBtn:hover,
    button#sendBtn:hover {
        filter: brightness(1.08);
    }
    .results-card {
        background: var(--bg-card);
        border: 1px solid var(--border-card);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-card);
        padding: 1.5rem 2rem;
        margin-bottom: 1rem;
    }
    .results-card h2 {
        margin-top: 0;
        font-size: 1rem;
        line-height: 1.3;
        font-weight: 600;
        color: var(--text-main);
    }
    #chartWrapper {
        width: 100%;
        max-height: 420px;
    }
    #resultChart {
        max-height: 420px;
    }
    .score-note {
        color: var(--text-dim);
        font-size: .8rem;
        line-height: 1.4;
        margin-top: .75rem;
    }
    .top3 {
        background: var(--accent-light);
        border: 1px solid var(--border-card);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-card);
        padding: 1.25rem 1.5rem;
        margin-bottom:1rem;
    }
    .top3 h3 {
        margin-top: 0;
        color: var(--accent);
        font-size: .9rem;
        font-weight: 600;
        line-height: 1.3;
    }
    .top3-list div {
        margin-bottom: .4rem;
        font-weight: 500;
        color: var(--text-main);
        font-size: .9rem;
    }
    .send-card {
        background:#fff;
        border:1px solid var(--border-card);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-card);
        padding:1.25rem 1.5rem;
        font-size:.85rem;
        line-height:1.4;
        color:var(--text-main);
    }
    .send-card h3 {
        margin:0 0 .5rem 0;
        color:var(--accent);
        font-size:.9rem;
        font-weight:600;
    }
    .send-card small {
        color:var(--text-dim);
        font-size:.75rem;
        line-height:1.4;
        display:block;
        margin-bottom:.75rem;
    }
    .send-field {
        margin-bottom:.75rem;
    }
    .send-field label {
        font-size:.8rem;
        color:#334155;
        display:block;
        margin-bottom:.25rem;
        font-weight:500;
    }
    .send-field input {
        width:100%;
        padding:.5rem .6rem;
        border:1px solid var(--border-card);
        border-radius:.5rem;
        font-size:.9rem;
        color:var(--text-main);
        background:#fff;
        box-sizing:border-box;
    }
    .send-field input:focus {
        outline:2px solid var(--accent);
        outline-offset:1px;
    }
    footer {
        color: var(--text-dim);
        font-size: .7rem;
        margin: 2rem auto 4rem auto;
        text-align: center;
        max-width: 900px;
        line-height: 1.4;
        padding: 0 1.5rem;
    }
</style>
</head>
<body>

<header class="site-header">
    <div class="header-inner">
        <div class="header-left">
            <img class="church-logo" src="slmc_logo.png" alt="Sugar Land Methodist Church Logo">
            <div class="church-text">
                Sugar Land Methodist Church
                <span>Discovering Your Spiritual Gifts</span>
            </div>
        </div>
        <div class="header-right">
            <div class="header-title">Spiritual Gifts Assessment</div>
            <div class="header-subtitle">
                “Now you are the body of Christ, and each one of you is a part of it.”
                — 1 Corinthians 12:27
            </div>
        </div>
    </div>
</header>

<div class="layout">
    <!-- LEFT COLUMN: FORM -->
    <div class="card">
        <div class="instructions">
            <p class="instructions-title">How to answer</p>
            <p>For each statement, choose the number that best describes you:</p>
            <ul style="margin-top:0;">
                <li>5 — Highly true of me / definitely true</li>
                <li>4 — Mostly true of me</li>
                <li>3 — True ~50% of the time</li>
                <li>2 — Sometimes true (~25% of the time)</li>
                <li>1 — Not true of me</li>
            </ul>
            <p style="margin-bottom:0;">Please answer all 80.</p>
        </div>

        <form id="surveyForm"></form>

        <button id="submitBtn" type="button">Show My Gifts</button>
    </div>

    <!-- RIGHT COLUMN: RESULTS / SEND -->
    <div>
        <div class="results-card">
            <h2>Your Gift Profile</h2>
            <div id="chartWrapper">
                <canvas id="resultChart" height="420"></canvas>
            </div>
            <div class="score-note">
                Each bar is one spiritual gift. Score range is 0–25 (5 questions × max 5). Higher scores often point to areas where God has especially equipped you to serve.
            </div>
        </div>

        <div class="top3">
            <h3>Your Top 3 Gifts</h3>
            <div class="top3-list" id="top3List">
                <div>Your top gifts will appear here after you submit.</div>
            </div>
        </div>

        <div class="send-card">
            <h3>Share with Sugar Land Methodist</h3>
            <small>We’ll receive only your contact info, your top 3 gifts, and all 16 gift scores so we can help you find a great serving fit. We will not see every individual question.</small>

            <div class="send-field">
                <label for="personName">Name</label>
                <input id="personName" placeholder="First and Last Name">
            </div>

            <div class="send-field">
                <label for="personEmail">Email</label>
                <input id="personEmail" placeholder="name@email.com">
            </div>

            <button id="sendBtn" type="button">Send My Results to the Church</button>
        </div>
    </div>
</div>

<footer>
    Spiritual Gifts list and question mapping adapted from the Spiritual Gifts Survey (© 2003 Lifeway Christian Resources, revised 2022).
</footer>

<script>
// 1. QUESTIONS (same as before)
const questions = [
    "1. I have the ability to organize ideas, resources, time, and people effectively.",
    "2. I am willing to study and prepare for the task of teaching.",
    "3. I am able to relate the truths of God to specific situations.",
    "4. I have a God-given ability to help others grow in their faith.",
    "5. I possess a special ability to communicate the truth of salvation.",
    "6. I have the ability to make critical decisions when necessary.",
    "7. I am sensitive to the hurts of people.",
    "8. I experience joy in meeting needs through sharing possessions.",
    "9. I enjoy studying.",
    "10. I have delivered God’s message of warning and judgment.",
    "11. I am able to sense the true motivation of persons and movements.",
    "12. I have a special ability to trust God in difficult situations.",
    "13. I have a strong desire to contribute to the establishment of new churches.",
    "14. I take action to meet physical and practical needs rather than merely talking about or planning how to help.",
    "15. I enjoy entertaining guests in my home.",
    "16. I can adapt my guidance to fit the maturity of those working with me.",
    "17. I can delegate and assign meaningful work.",
    "18. I have an ability and desire to teach.",
    "19. I am usually able to analyze a situation correctly.",
    "20. I have a natural tendency to encourage others.",
    "21. I am willing to take the initiative in helping other Christians grow in their faith.",
    "22. I have an acute awareness of other people’s emotions, such as loneliness, pain, fear, and anger.",
    "23. I am a cheerful giver.",
    "24. I spend time digging into facts.",
    "25. I feel that I have a message from God to deliver to others.",
    "26. I can recognize when a person is genuine/honest.",
    "27. I am a person of vision ...",
    "28. I am willing to yield to God’s will rather than question and waver.",
    "29. I would like to be more active in getting the gospel to people in other countries.",
    "30. It makes me happy to do things for people in need.",
    "31. I am successful in getting a group to do its work joyfully.",
    "32. I am able to make strangers feel at ease.",
    "33. I have the ability to teach to a variety of different learning styles.",
    "34. I can identify those who need encouragement.",
    "35. I have trained Christians to be more obedient disciples of Christ.",
    "36. I am willing to do whatever it takes to see others come to Christ.",
    "37. I am drawn to people who are hurting.",
    "38. I am a generous giver.",
    "39. I am able to discover new truths in Scripture.",
    "40. I have spiritual insights from Scripture ...",
    "41. I can sense when a person is acting in accordance with God’s will.",
    "42. I can trust in God even when things look dark.",
    "43. I can determine where God wants a group to go and help it get there.",
    "44. I have a strong desire to take the gospel to places where it has never been heard.",
    "45. I enjoy reaching out to new people in my church and community.",
    "46. I am sensitive to the needs of people.",
    "47. I have been able to make effective and efficient plans for accomplishing the goals of a group.",
    "48. I often am consulted when fellow Christians are struggling to make difficult decisions.",
    "49. I think about how I can comfort and encourage others in my congregation.",
    "50. I am able to give spiritual direction to others.",
    "51. I am able to present the gospel to lost persons ...",
    "52. I possess an unusual capacity to understand the feelings of those in distress.",
    "53. I have a strong sense of stewardship based on the recognition that God owns all things.",
    "54. I have delivered to other persons messages that have come directly from God.",
    "55. I can sense when a person is acting under God’s leadership.",
    "56. I try to be in God’s will continually and be available for His use.",
    "57. I feel that I should take the gospel to people who have different beliefs from me.",
    "58. I have an acute awareness of the physical needs of others.",
    "59. I am skilled in setting forth positive and precise steps of action.",
    "60. I like to meet visitors at church and make them feel welcome.",
    "61. I explain Scripture in such a way that others understand it.",
    "62. I can usually see spiritual solutions to problems.",
    "63. I welcome opportunities to help people who need comfort, consolation, encouragement, and counseling.",
    "64. I feel at ease in sharing Christ with nonbelievers.",
    "65. I can influence others to perform to their highest God-given potential.",
    "66. I recognize the signs of stress and distress in others.",
    "67. I desire to give generously and unpretentiously to worthwhile projects and ministries.",
    "68. I can organize facts into meaningful relationships.",
    "69. God gives me messages to deliver to His people.",
    "70. I am able to sense whether people are being honest ...",
    "71. I enjoy presenting the gospel to persons of other cultures and backgrounds.",
    "72. I enjoy doing little things that help people.",
    "73. I can give a clear, uncomplicated presentation of the gospel.",
    "74. I have been able to apply biblical truth to the specific needs of my church.",
    "75. God has used me to encourage others to live Christlike lives.",
    "76. I have sensed the need to help other people become more effective in their ministries.",
    "77. I like to talk about Jesus to those who do not know Him.",
    "78. I have the ability to make strangers feel comfortable in my home.",
    "79. I have a wide range of study resources and know how to secure information.",
    "80. I feel assured that a situation will change for the glory of God even when the situation seems impossible."
];

// 2. GIFT DEFINITIONS (order matters!)
const gifts = [
    { name: "Leadership",        items: [6,16,27,43,65] },
    { name: "Administration",    items: [1,17,31,47,59] },
    { name: "Teaching",          items: [2,18,33,61,73] },
    { name: "Knowledge",         items: [9,24,39,68,79] },
    { name: "Wisdom",            items: [3,19,48,62,74] },
    { name: "Prophecy",          items: [10,25,40,54,69] },
    { name: "Discernment",       items: [11,26,41,55,70] },
    { name: "Exhortation",       items: [20,34,49,63,75] },
    { name: "Shepherding",       items: [4,21,35,50,76] },
    { name: "Faith",             items: [12,28,42,56,80] },
    { name: "Evangelism",        items: [5,36,51,64,77] },
    { name: "Apostleship",       items: [13,29,44,57,71] },
    { name: "Service/Helps",     items: [14,30,46,58,72] },
    { name: "Mercy",             items: [7,22,37,52,66] },
    { name: "Giving",            items: [8,23,38,53,67] },
    { name: "Hospitality",       items: [15,32,45,60,78] }
];

let chart; // Chart.js instance

function buildForm() {
    const form = document.getElementById("surveyForm");
    questions.forEach((text, i) => {
        const qNum = i + 1;

        const block = document.createElement("div");
        block.className = "question";

        const label = document.createElement("div");
        label.className = "q-text";
        label.textContent = text;

        const row = document.createElement("div");
        row.className = "q-scale";

        const sel = document.createElement("select");
        sel.name = "q" + qNum;
        sel.required = true;

        const opt0 = document.createElement("option");
        opt0.value = "";
        opt0.textContent = "Select 1–5";
        sel.appendChild(opt0);

        const choices = [
            {val:5, text:"5 (Highly true of me)"},
            {val:4, text:"4 (Mostly true)"},
            {val:3, text:"3 (About half the time)"},
            {val:2, text:"2 (Sometimes true)"},
            {val:1, text:"1 (Not true of me)"}
        ];
        choices.forEach(c => {
            const o = document.createElement("option");
            o.value = c.val;
            o.textContent = c.text;
            sel.appendChild(o);
        });

        row.appendChild(sel);
        block.appendChild(label);
        block.appendChild(row);
        form.appendChild(block);
    });
}

function calculateScores() {
    const form = document.getElementById("surveyForm");
    const scores = [];

    for (const gift of gifts) {
        let sum = 0;
        for (const qNum of gift.items) {
            const field = form.elements["q" + qNum];
            const val = parseInt(field.value || "0", 10);
            sum += val;
        }
        scores.push(sum);
    }
    return scores;
}

function showTop3(scores) {
    const pairs = gifts.map((g, idx) => ({ name: g.name, score: scores[idx] }));
    pairs.sort((a,b) => b.score - a.score);

    const top3Div = document.getElementById("top3List");
    top3Div.innerHTML = "";
    for (let i = 0; i < 3 && i < pairs.length; i++) {
        const row = document.createElement("div");
        row.textContent = `${i+1}) ${pairs[i].name} (${pairs[i].score})`;
        top3Div.appendChild(row);
    }
}

function drawChart(scores) {
    const ctx = document.getElementById("resultChart").getContext("2d");
    const labels = gifts.map(g => g.name);

    if (chart) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = scores;
        chart.update();
    } else {
        chart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: "Spiritual Gift Score (0–25)",
                    data: scores,
                    backgroundColor: "rgba(28,79,158,0.15)",
                    borderColor: "rgba(28,79,158,1)",
                    borderWidth: 2,
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 25,
                        grid: { color: "rgba(0,0,0,0.05)" },
                        ticks: {
                            color: "#475569"
                        }
                    },
                    y: {
                        grid: { color: "rgba(0,0,0,0.03)" },
                        ticks: {
                            color: "#1e293b",
                            font: { size: 12, weight: "500" }
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: "#1e293b",
                            font: { size: 12 }
                        }
                    }
                }
            }
        });
    }
}

// show chart and top3 when user clicks "Show My Gifts"
document.getElementById("submitBtn").addEventListener("click", () => {
    // validate required answers
    const allSelects = document.querySelectorAll("#surveyForm select");
    for (const sel of allSelects) {
        if (!sel.value) {
            alert("Please answer all 80 questions (1–5) before continuing.");
            sel.scrollIntoView({behavior:"smooth", block:"center"});
            sel.focus();
            return;
        }
    }

    const scores = calculateScores();
    drawChart(scores);
    showTop3(scores);

    // scroll to chart on phones
    document.getElementById("resultChart").scrollIntoView({ behavior: "smooth" });
});

// 3. SEND RESULTS TO GOOGLE SHEET
async function sendResultsToSheet() {
    // must have calculated scores already
    if (!chart) {
        alert("Please click 'Show My Gifts' first so we can score your results.");
        return;
    }

    // get scores in the same order as gifts[]
    const scores = calculateScores();

    // figure out top 3 gifts
    const pairs = gifts.map((g, idx) => ({ name: g.name, score: scores[idx] }));
    pairs.sort((a,b) => b.score - a.score);
    const topGifts = [
        `${pairs[0].name} (${pairs[0].score})`,
        `${pairs[1].name} (${pairs[1].score})`,
        `${pairs[2].name} (${pairs[2].score})`,
    ];

    // get name/email from inputs
    const name  = document.getElementById("personName").value.trim();
    const email = document.getElementById("personEmail").value.trim();

    if (!name || !email) {
        alert("Please enter your name and email so the church can follow up.");
        return;
    }

    const payload = {
        name,
        email,
        topGifts,
        scores
    };

    try {
        const res = await fetch("https://script.google.com/macros/s/AKfycby3h3tDfeHM11HCiJ1sq29UrALKLd2Y11Yx_oMKm91-mOzRb12DLSlH2F0m5eSkIeEkUw/exec", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (res.ok) {
            alert("Thank you! Your results have been sent to Sugar Land Methodist.");
        } else {
            alert("Sorry, there was an issue sending your results.");
        }
    } catch (err) {
        alert("Network error sending results.");
    }
}

document.getElementById("sendBtn").addEventListener("click", sendResultsToSheet);

// init form on load
buildForm();
</script>
</body>
</html>
